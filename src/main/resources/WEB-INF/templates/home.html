<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="utf-8">
    <title layout:title-pattern="$CONTENT_TITLE: $LAYOUT_TITLE">The Site</title>
    <link th:href="@{static/favicon.ico}" href="../../static/favicon.ico" rel="icon" type="image/ico">
    <link th:href="@{static/css/style.css}" href="../../static/css/style.css" rel="stylesheet">
    <script
        id="gl-matrix-js"
        src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js"
        integrity="sha512-zhHQR0/H5SEBL3Wn6yYSaTTZej12z0hVZKOv3TwCUXT1z5qeqGcXJLLrbERYRScEDDpYIJhPC1fk31gqR783iQ=="
        crossorigin="anonymous"
        defer></script>
    </script>
    <script th:src="@{static/js/fluid/shaderSources.js}" type="module" th:id="shader-source-js" defer></script>
    <script th:src="@{static/js/fluid/controller.js}" type="module" th:id="fluid-controller-js" defer></script>
    <script th:src="@{static/js/page/navigation.js}" type="module" th:id="nav-controller-js" defer></script>
</head>
<body>
    <div id="main-scroller">
        <!-- Shader Show Off Area -->
        <div>
            <canvas id="shader-canvas" width="480" height="480"></canvas>
            <div id="shader-canvas-veil"></div>
        </div>
        <!-- Main Body -->
        <div id="floating-body">
            <!-- Splash -->
            <div class="body-container">
                <div id="splash">
                    <p th:text="${splashText}">Example Splash!</p>
                </div>
            </div>

            <!-- Content -->
            <div class="body-container paragraph-container">
                <h2>Pages:</h2>
                <ul>
                    <li th:each="page: ${pageRefs}">
                        <p><a th:text="${page.name}" th:href="${page.location}">Example page with link</a></p>
                        <p th:text="${page.description}" class="paragraph">Example description</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div th:replace="~{fragments/header :: header}" class="container">
        <header th:fragment="header" id="page-header">
            <div>
                <a th:href="@{/home}">The Site.</a>
            </div>
        </header>
    </div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}">
        <footer th:fragment="footer" id="page-footer">
            <div id="footer-date">
                Server Time: the <span th:text="${day}">Nth</span> day of the <span th:text="${month}">Nth</span> month of the <span th:text="${year}">Nth</span> year CE.
            </div>
        </footer>
    </div>
</body>

<div th:remove="all">
    <!-- REMOVED IN PRODUCTION. This is for local testing because of cross-domain CORS rules -->
    <script id="fluid-controller-js" src="../../static/js/fluid/controller.js" defer></script>
    <script id="shader-source-js" src="../../static/js/fluid/shaderSources.js" defer></script>
    <script id="nav-controller-js" src="../../static/js/page/navagation.js" defer></script>
</div>
<script id="init-script">
    const helperScriptCount = 4;
    var helperScriptsLoaded = 0;
    function pollForInit(name) {
        if (++helperScriptsLoaded == helperScriptCount) {
            initNavigation();
            initFluidSim();
        }
    }

    document.getElementById("gl-matrix-js").addEventListener("load", () => pollForInit("gl-matrix"));
    document.getElementById("fluid-controller-js").addEventListener("load", () => pollForInit("fluid-controller"));
    document.getElementById("shader-source-js").addEventListener("load", () => pollForInit("shader-source"));
    document.getElementById("nav-controller-js").addEventListener("load", () => pollForInit("nav-controller"));
</script>
</html>